<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>qooxdoo &raquo; Demo Browser</title>
  <script type="text/javascript" src="../../script/demo.js"></script>
  <script type="text/javascript" src="../util.js"></script>
</head>
<body>  <style type="text/css">*{ font-size: 10px; font-family: Verdana }</style>

  <div id="description">
    <p>Test table.</p>
  </div>

  <textarea id="info" style="position:absolute; top:48px; left:20px; width:600px;height:50px;border:1px solid black"></textarea>
  <div id="view" style="position:absolute;top:148px;left:20px;width:400px;height:500px;border:1px solid black"></div>
  <div id="scroller" style="position: absolute; top:148px; left:420px;height:500px;width:24px;border:1px solid black;overflow:scroll"><div id="scrollerContent" style="width:1px;height:5000px"></div></div>
	<input type="button" id="button" value="Update" style="position:absolute; top:110px; left:20px;"></input>

  <script type="text/javascript">
  qx.core.Init.getInstance().defineMain(function()
  {
    var updateCount = 0;

    var tableHeight = 16*30; //512;

    var entryCount = 1000;

    var rowHeight = 16;
    var rowCount = Math.floor(tableHeight / rowHeight);

    var view = document.getElementById("view");
    var info = document.getElementById("info");
    var scroller = document.getElementById("scroller");
    var scrollerContent = document.getElementById("scrollerContent");



    view.style.height = scroller.style.height = tableHeight + "px";
    scrollerContent.style.height = Math.round(entryCount / rowCount * tableHeight) + "px";


    var data = [];

    for (var i=0; i<1000; i++) {
      data.push({ col1 : "hello" + i, col2 : "world" + i, col3 : "foo" + i, col4 : "bar" + i, col5 : "baz" + i });
    };

    var HTML =
    {
      table_start : "<table><tbody>",
      table_end : "</tbody></table>",

      tr_start : "<tr>",
      tr_start_open : "<tr ",
      tr_start_close : ">",
      tr_end : "<tr>",

      td_start : "<td>",
      td_end : "</td>"
    };

		function fillTable(start, rowCount)
		{
      var ttstart = (new Date).valueOf();

			var cellIndex = 0;
			var rowStyleIndex = 0;

      for (var i=start, s=start+rowCount; i<s; i++) {
        var rdata = data[i];
	      if (i % 2 == 0) {
	        html[rowStyles[rowStyleIndex]] = "style='background-color:#fff'";
	      } else {
  	      html[rowStyles[rowStyleIndex]] = "style=''";
	      }
				rowStyleIndex += 1;

        for (var row in rdata) {
        	html[cells[cellIndex++]] = rdata[row];
      	};
      };

      view.innerHTML = html.join("");

      var ttend = (new Date).valueOf();
      info.value = "Update: " + updateCount + "\nRows: " + start + " - " + (start+rowCount) + "\n" + (ttend-ttstart) + "ms\n";
		}


		function createTableTemplate(rowCount)
		{
		  html = []; // global
		  cells = []; // global
			rowStyles = [] // global

		  var i=0;
		  html[i++] = HTML.table_start;

		  for (var rowIndex=0; rowIndex<rowCount; rowIndex++)
		  {
	      html[i++] = HTML.tr_start_open;

        rowStyles.push(i++);

	      html[i++] = HTML.tr_start_close;

				for (var colIndex=0; colIndex<5; colIndex++)
				{
					html[i++] = HTML.td_start;
					cells.push(i++);
					html[i++] = HTML.td_end;
				}

				html[i++] = HTML.tr_stop;
		  }

		  html[i++] = HTML.table_end;
		}

		createTableTemplate(rowCount);

    function doscroll() {
      fillTable(Math.floor(scroller.scrollTop/rowHeight), rowCount);
    };

    qx.html.EventRegistration.addEventListener(scroller, "scroll", doscroll);
    doscroll();

    document.getElementById("button").onclick = doscroll;
  });
  </script>
</body>
</html>
